<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  
	<title>TagLab Interface</title>
	<style>


key {
	border: 1px solid #b6b6b6;
	padding: 0 0.3em;
	margin: 0.1em 0.3em;
	border-radius: 5px;
	background: #f2f3f3;
/*	background: radial-gradient(#f2f3f3 60%, #cecece); */
	display: inline-block;
	min-width: 2em;
	text-align: center;
	font-size: 85%;
	white-space: nowrap;
}

/* Demo site CSS. Not mobile first, not semantic, not optimized, made for 20 minutes, mess */
html, body, div, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, ol, ul, li, form, fieldset, legend, label, table, header, footer, nav, section, figure {
	margin: 0;
	padding: 0; 
}
a { color: #3169B3; text-decoration:none; }
a:hover { color: #C00; text-decoration:none;}

* {
	-moz-box-sizing: border-box;
	-webkit-box-sizing: border-box;
	box-sizing: border-box;
}

body {
	padding-top:40px;
	width:100%;
	font-family: Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;
	font-size: 18px;
	line-height: 26px;
	color: #444;

	text-rendering: optimizeLegibility;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	-moz-font-feature-settings: "liga", "kern";
}

p {
	margin: 0 0 12px;
	/*margin: 0; */
	padding-bottom: 12px;
	padding-top: 12px;
}

h1, h2, h3, h4, h5, h6 {
	font-weight: 500;
	color:#222;
/*	font-weight: 600; */
} 


ul, ol {
	margin-top: 8px;
	margin-bottom: 8px;
}

li {
	margin: 0;
	padding: 4px 0;
}

ul {
	list-style: disc;
}


h1 {
	font-size: 48px;
	line-height: 1;
	margin: 0;
	margin-bottom: 24px;
}

h2 {
	font-size: 32px;
	line-height: 1.1;
	margin: 36px 0 12px;
}

h3 {
	font-size: 22px;
	line-height: 28px;
	margin: 24px 0 0px 0;
}

strong {
	font-weight: 600;
}

em {
	font-weight:600;
	font-style:normal;
}

.section {
	width: 100%;
	margin: 0px auto;
	padding: 0px 10px;
	max-width: 960px;
}


@media screen and (max-width: 450px) {
	.section {
		margin-top: 88px;
	}
}

@media screen and (max-width: 650px) {
}


@media screen and (max-width: 700px) {
}


@media screen and (max-width: 1000px) {
	.section {
		max-width: 800px;
	}
}

	</style>
</head>
<body>

<div class="section docs">

<h1>TagLab Interface</h1>

<p>TagLab user interface is subdivided into three main components: </p>
 
 <h3> The Tool Bar </h3>

     <p>The toolbar is located on the left side of the interface. It contains the following operation buttons, individually activable:</p>
    
    
    <ul>
    <li><a href="#move">Move</a>  enables Pan/Zoom operations. 
    <li><a href="#assigntool">Assign</a> assigns a semantic class.
    <li><a href="#freehand">Freehand drawing</a>  allows manually drawing corals borders. 
    <li><a href="#editborder">Edit Border</a> (coral alike icon) allows quick contour editing.
    <li><a href="#cut">Cut</a> segmentation (scissors icon) provides a fast guided separation of labels. 
    <li><a href="#crack">Crack</a> interactively places cracks.
    <li><a href="#split">Split</a> blob  automatically separates label masks.
    <li><a href="#ruler">Ruler</a>  takes linear measures, between a pair of points or objects centroids.
    <li><a href="#4clicks">4-clicks</a> implementsCNN-assisted agnostic segmentation.
    <li><a href="#fully">Fully automatic classification</a>  allows to select a pre-trained semantic segmentation network from the ones available, and apply it to the map.
    </ul>


     <h3> Working View </h3>
<p>The Working View covers the central part of the interface and contains the orthomosaic map.
 Navigation is straightforward: zoom (wheel to zoom in and out) is always allowed, but the pan 
 is enabled only when the Pan Tool is active or by pressing the <key>Ctrl</key>+mouse left button (when one of the other tools is active).
 Above the Working View, a slider allows adjusting masks transparency.</p>


 <h3> The Right Panel </h3>
<p>This section is partitioned into different subpanels.
 From the top: the Warnings message box, the Labels panel, the Comparison panel, the Segmentation info box, and the Map viewer.  
 The Labels Panel displays a list of colors and class names.
 It can be configured by editing a configuration file containing data about the available classifiers and the pair label name-color used by the specific application.</p>

<p>The visibility of each class in the working view can be switch using the eye icon, singularly or in groups (by pressing <key>Ctrl</key> or <key>Shift</key>).
 This supports the visualization of the distribution of a specific species and the export of targeted maps, tabs, or statistics (only visible tags are processed).</p>

<p>The Comparison Panel displays the current editable annotations plus overlapping annotations from others projects, in a non-editable mode, and a dashing appearance. Annotations from multi-temporal surveys can be loaded from File &gt; Compare annotation.</p>

<p>The Segmentation Info box shows properties related to the selected label.
 More precisely: coordinates, class, perimeter, area, and an editable note field. This information are updated simultaneously after every operation.</p>

<p>The Map viewer, on the bottom right of the interface, highlights the map region under viewing in the Working View, assisting the navigation of extensive maps. The Map Viewer is interactive, too; the working area can be selected by a single click or by panning on the rectangle of interest.</p>

</p>




<h1>TagLab: HOW TO</h1>


<h2>Create an manage a project</h2>
<h3> File &gt; Load Map </h3>

<p>Browse an image map from your PC, with the current settings: </p>


<ul>
<li>TagLab only supports <b>.jpg</b> and <b>.png</b> RGB images with a maximum size of 32767x32767 pixels.</li>
<li>TagLab doesn't support images having a transparency channel.</li>
</ul> 

<p>If TagLab crashes after the map loading the image format is probably not supported.
Fill all the fields in the <em>map settings</em> menu, the px-to-mm conversion allows to measure areas in cm<sup>2</sup>
and lengths in cm. If this value is settled to 2.0 a pixel is 2mm long.</p>


<h3>File &gt; New Project </h3>

<p>This option discard the current project and re-initializes the interface. </p>


<h3>File &gt; Open Project </h3>

<p>It allows loading an existing project. This command loads both maps and annotations.
If the map has been moved into another folder, Taglab asks you to load it again.
The project file can be moved anywhere. Recents open projects are directly visible in the File menu. </p>


<h3> File &gt; Save Project  </h3>

<p>It saves the current project. The project file contains a reference to the loaded map, the map settings,
your annotations (list of points), and all additional information such as the assigned classes,
areas, perimeter, centroids. The project is saved as a JSON file. </p>



<h2>Import options</h2>

<h3>File &gt; Import Options &gt; Append Annotation to Current</h3>

<p>Appends a set of polygons (saved in a .json file) to the current project. This is useful when you have a set of polygons belonging to class A and you would like to add the previously segmented class B on the same map. Warnings: previously created annotation must be created on the same map or a map of the same size. </p> 

<h3>File &gt; Import Options &gt; Compare Annotations</h3>

<p>Imports a set of annotations in a separate layer. Multiple annotations are visible in the Comparison panel on the right. New annotations exhibit dashed contours and are not editable. This option is extremely useful to visually compare 2D changes in multi-temporal maps. Visibility might be switched on and of using the eye icon. We planned to add boolean operations between different layers. </p> 

<h3>File &gt; Import Options> Import Label map.</h3>

<p>Loads a segmented .jpg or .png map in an existing projects. This option polygonizes a label map, and new polygons are appended to the existing ones. The map must have a black (RGB(0,0,0)) background, and foreground classes must be present in your .config file. It may be useful to use Taglab edit options on a previous segmentation.</p>


<h2>Export options</h2>

<h3>File &gt; Export Options &gt; Annotation as data table</h3>

<p> saves a.csv files containg a unique ID for each polygon, class information,  area, perimeter, centroids coordinates and additional notes</p> 

<h3>File &gt; Export Options &gt; Annotations as map</h3>

<p> saves a.png label a pixel-wise segmented map with a black background class and foreground classes according to the <em>visible</em> classes in your label panel. Class visibility might be 
switch on and off using the eye icon </p> 

<h3>File &gt; Export Options &gt; Histograms</h3>

<p> Clicking preview creates a histogram containing all the foreground classes checked in the create and export histogram menu. It calculates the coverage automatically in square meters of each class.</p>


<h3>File &gt; Export Options &gt; Training Dataset</h3>

<p> Export squared tiles of 1026 pixels with an overlap of 50%. TagLab exports each RGB map tile with the corresponding label tile with the same suffix. These are the settings that we use in our training. </p>

</body>


<h2>Commands</h2>
<p> Undo and Redo operations work with <key>Ctrl + z</key>, <key>Crtl + Shift + z</key> </p>


<h3>Select</h3>
<p>Operations can only be applied on selected labels. For the single label selection, double click inside a label. Polygon outline of the selected labels changes from black to white.
Almost all operations work with a single selected label, except delete, boolean operations (merge, divide, subtract), assign class, that allows multiple selections. Labels can be added to the selection using <key>Shift</key> + left click)
or a group of label can be selected by dragging a rectangular window (<key>Shift</key> + left click+drag). To select labels in this way, be sure to include them entirely in the rectangle.</p> 


<h3>Confirm operation</h3>
<p> To carry out an operation, select a tool, select a polygon if required by the process, perform edits, and then press <key>Space bar</key> to apply it.</p>


<h3>Reset tool </h3>
<p>Any operation not carried out adequately can be canceled by pressing <key>Esc</key> before confirmation.</p> 



<h2>Tools</h2>
<a name="zoom"></a>
<p>The zoom tool is always active by using the scroll. Tools are activable only singularly. Taglab has two smart tools, the 4-click tools and the Fully automatic segmentation tools, all the other implements
classical image processing algorithms. For each operation computed on labels the information contained in the Info Panel are automatically adjusted. </p>


<a name="move"></a>
<h3>Move</h3>
<p> When the move tool is selected the image pan operation is active (left click + drag) . When on of the others tool is selected the pan operation is allowed only by pressing <key>Ctrl</key> (left click + drag)
Pan Move and zoom operation in the Main view are sincronized with ones in the Map viewer on the bottom right. The map viewer is interactive too, can be use to navigate large maps and always
displays the current position inside an highlighted window.  </p> 

<a name="assigntool"></a>
<h3>Assign</h3>

<p> When the assing (buket icon) tool is active, all the clicked blobs assumes the class property and the correspondig color values of the selected class in the labels panel. Multiple selection is allowed by pressing <key>Shift</key> (same options as below). If multiple blobs are selected and the bucket tool is active, all blobs are simultanously assigned to the same class </p>

<a name="freehand"></a>
<h3>Freehand drawing</h3>

<p> When the Freehand drawing is active users can draw a pixel-wise curve of a fixed thickness of 1px. The curves doesn't need to be draw continuosly but can be drawn in different overlapping segments. 
By pressing <key>Space bar</key> the operation is applied and the curve became a polygon. Only closed curve can became polygons, unclosed curves are automatically removed. Curves might intersect themselves several times but they always produced a unique closed polygon without holes.</p>

<p>There is no need to exactly match the start and the end of the line. Additional segments, inside or outside the polygon are automatically removed too. Operation can be discarded in every moment (before confirming) by pressing <key>Esc</key>. Drawing is always allowed also internally to another blob</p>


<a name="editborder"></a>
<h3>Edit Border</h3>

<p>When this tool is selected, the user can arbitrary draw some segment on a <em>single selected</em> blob. 
Areas included or excluded from the edit curves are automatically added or removed from the selected blob. Information in the info panel is automatically updated. If no blob is selected or multiple blobs are selected, the edit operation cannot be applyed; select a single area and press <key>Spacebar</key> again.
<p>Curves don't need to be continue and can be concave or covex. Curves must crossing the coral borders at least <em>twice</em>
to be effective, otherwise they will be automatically removed. Any inner labels contours can be edited following the same criterion. The snapping option is always active and the resulting polygon cleaned from unwanted scratches.
By pressing <key>Esc</key> before confirming all the editing curves eill be removed. Undo and Redo operation are always allowed.
 </p> 

<a name="cut"></a>
<h3>Cut</h3>

<p> This tool works exactly like the Edit border tool except that the regions subtended by the edit curves are not removed but separated from the current blob.
 After confirmation (<key>Space bar</key>) of the Cut operation, they become blobs. The class assigned by default is the same as the starting blob.  </p>

<a name="crack"></a>
<h3>Crack</h3>

<p> The Crack Tool is useful to quickly select cracks inside a blob and remove them, creating inners blob contours.
 When the Crack Tool is active, clicking on a crack point opens the Crack window. The window has a slider that allows 
adjusting the selected area. The result of the selection is visible through the preview (which is zoomable). The operation is confirmed by pressing the Apply button.</p>

<a name="split"></a>
<h3>Split</h3>

<p>This tool is used to separate groups of many blobs connected by bottlenecks quickly.
 Once the group has been selected, the user must place a point in the center of each blob that he intends to split.
 The operation is confirmed by pressing <key>Space bar</key>. If bottlenecks do not join the blobs, the result might be uncertain. </p>

<a name="ruler"></a>
<h3>Ruler</h3>

<p>The ruler can measure the distance (express in cm if the px to mm transformation is known) between two 
points or the distance between blob's centroids. In this last case, the user has to select two blobs, and the ruler will be snapped to the centroids. </p>

<a name="4clicks"></a>
<h3>4-clicks</h3>

<p>This tool quickly traces the edges of an object. The user, helped by the cross cursor,
 must place four points at the object's extremes (extreme top, extreme bottom, extreme left, extreme right).
 There is no need to follow a specific order, but it's necessary to position them as accurately as possible near the extremes. After placing the fourth point, the contours of the object are 
automatically delimited through a neural network called <a href="https://github.com/scaelles/DEXTR-PyTorch/"> Deep Extreme Cut</a> . 
This tool works only if you have the network's weights properly placed in TagLab's 'models' folder. </p>




<a name="fully"></a>
<h3>Fully automatic segmentation </h3>

<p>This tool loads and apply pre-trained binary classifiers based on the fully automatic semantic segmentation network <a href="https://github.com/jfzhang95/pytorch-deeplab-xception/"> DeepLab V3+ </a> . 
When activated, it opens a window and demands the selection of compatible classifiers among 
those available in the 'models' folder. The following fields are not editable; they are read directly from the config.json file. The segmentation operation begins when the user press Apply. The progress of processing is declared by the progress bar at the top left. As soon as the classification starts, in the TagLab folder, a 'temp' subfolder is created, and the annotations are saved into separate tiles, and then recomposed in a single mosaic map. At the end of the operation, the user must save
 the project and close TagLab. If the process ends before displaying the labels, 
 but if the labeled map has been created, use the 'File> Import Label Map' option to load them correctly. </p>


<h2>Labels Operations</h2>


<a name="assignop"></a>
<h3>Assign</h3>
<p><key>A</key> This shortcut assigns the selected class in the labels panel to the selected blob/blobs.</p>

<a name="fill"></a>
<h3>Fill</h3>
<p><key>F</key> By pressing F with a selected blob, holes inside the blob are filled. </p>

<a name="delete"></a>
<h3>Delete</h3>
<p><key>Canc</key> Remove selected blob/blobs </p>

<a name="merge"></a>
<h3>Merge</h3>
<p><key>M</key> This tool creates a single label from some randomly selected overlapping blobs.</p>

<a name="divide"></a>
<h3>Divide</h3>
<p><key>D</key> This tool only works with two overlapping selected blobs for separating them. 
Be careful — the selection order matters. The contour of the first prevails over the second. </p>

<a name="subtract"></a>
<h3>Subtract</h3>
<p><key>S</key> This tool only works with two overlapping selected blobs for remove the second from the first. Be careful — the selection order matters.
The second blob can also be entirely contained in the first. In that case, a hole will be created.</p>

<a name="refine"></a>
<h3>Refine</h3>
<p><key>R</key> The tool works when a single blob is selected. By pressing R blob, contours will be adjusted to follow the edges (the gradient) of the image.
 The refinement tool can be used to improve the precision of the contours of the specimen without straying too far from the existing ones.  Pressing  - or + the tool, the refinement is applied in an erode or dilate modality.</p>

</div>

</body>



</html>
